@startuml
title 관리자 사용자 관리 활동 다이어그램

|#LightBlue|사용자 검색/조회|
start

:사용자 검색 요청;
note right: 검색 조건, 페이지 정보

:관리자 권한 검증;

if (관리자 권한 있음?) then (아니오)
  :403 Forbidden 응답;
  stop
endif

:검색 조건으로 사용자 조회;
note right: 이메일, 상태, 통계 정보 포함

:200 사용자 목록 응답;

:사용자 상세 정보 요청;

fork
  :사용자 기본 정보 조회;
fork again
  :스터디 참여 이력 조회;
fork again
  :제재 이력 조회;
fork again
  :신고 이력 조회;
end fork

:사용자 상세 정보 구성;

:200 상세 정보 응답;

|#LightCoral|계정 정지|
:계정 정지 요청;
note right: 사유, 기간, 알림 여부

:정지 권한 검증;

if (정지 권한 있음?) then (아니오)
  :403 Permission Denied 응답;
  stop
endif

if (이미 정지된 계정?) then (예)
  :400 Already Suspended 응답;
  stop
endif

:사용자 상태를 SUSPENDED로 변경;
:제재 레코드 생성;
:모든 활성 세션 무효화;
:진행 중인 스터디 활동 제한;

if (사용자 알림 설정?) then (예)
  :정지 알림 발송;
endif

:정지 감사 로그 기록;

:200 정지 완료 응답;

|#LightGreen|계정 정지 해제|
:정지 해제 요청;
note right: 해제 사유

:해제 권한 검증;

if (정지 상태?) then (아니오)
  :400 Not Suspended 응답;
  stop
endif

:사용자 상태를 ACTIVE로 복구;
:활성 정지 제재 해제;
:정지 해제 알림 발송;
:해제 감사 로그 기록;

:200 해제 완료 응답;

|#LightYellow|권한 관리|
:권한 변경 요청;
note right: 새 역할, 액션

:권한 관리 권한 검증;

if (권한 변경 가능?) then (아니오)
  :403 Permission Denied 응답;
  stop
endif

:사용자 역할 업데이트;
:활성 세션의 역할 정보 갱신;
:역할 변경 알림 발송;
:권한 변경 감사 로그 기록;

:200 권한 변경 완료 응답;

|#LightSalmon|계정 삭제|
:계정 삭제 요청;

:삭제 권한 검증;

:사용자 관련 데이터 정리;
note right: 개인정보 익명화

:삭제 감사 로그 기록;

:200 삭제 완료 응답;

stop

@enduml
