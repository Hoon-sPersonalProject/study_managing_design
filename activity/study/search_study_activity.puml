@startuml
title 스터디 검색 및 상세보기 활동 다이어그램

|#LightBlue|스터디 검색|
start

:검색 요청 수신;
note right: 키워드, 지역, 페이지 정보

:검색 조건 파싱;

:검색 로그 기록;

:캐시된 검색 결과 확인;

if (캐시 히트?) then (예)
  :캐시된 결과 반환;
else (아니오)
  :검색 쿼리 정규화;
  :검색 인덱스에서 검색 실행;
  :스터디 ID 목록 획득;
  :데이터베이스에서 스터디 정보 조회;
  :가시성 필터링;
  note right: 공개/비공개, 차단 필터
  :정렬 적용;
  note right: 인기도, 최신순, 관련도
  :검색 결과 캐싱;
endif

:응답 데이터 변환;

:200 검색 결과 응답;

|#LightGreen|스터디 상세보기|
:상세보기 요청 수신;
note right: 스터디 ID

:캐시된 상세 정보 확인;

if (캐시 히트?) then (예)
  :캐시된 상세 정보 반환;
else (아니오)
  :스터디 정보 조회;

  if (스터디 존재?) then (아니오)
    :404 Not Found 응답;
    stop
  endif

  :가시성 검증;

  if (접근 권한 있음?) then (아니오)
    :403 Access Denied 응답;
    stop
  endif

  fork
    :스터디 리더 정보 조회;
  fork again
    :멤버 수 조회;
  fork again
    :사용자 신청 상태 확인;
  fork again
    :사용 가능한 액션 계산;
  end fork

  :상세 정보 구성;
  :상세 정보 캐싱;
endif

:조회수 증가;
:조회 로그 기록;

:200 상세 정보 응답;

stop

@enduml
