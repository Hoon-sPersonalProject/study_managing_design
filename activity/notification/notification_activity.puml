@startuml
title 알림 관리 활동 다이어그램

|#LightBlue|알림 생성|
start

:알림 이벤트 발생;
note right: 스터디 신청, 승인, 변경 등

:알림 대상 사용자 식별;

:사용자 알림 설정 확인;

if (알림 수신 설정?) then (아니오)
  stop
endif

:알림 메시지 구성;
note right: 템플릿 기반 메시지 생성

:알림 저장;

fork
  :인앱 알림 생성;
fork again
  if (이메일 알림 설정?) then (예)
    :이메일 큐에 추가;
  endif
fork again
  if (푸시 알림 설정?) then (예)
    :푸시 알림 큐에 추가;
  endif
end fork

|#LightGreen|알림 발송|
:알림 발송 작업 처리;

:이메일 알림 발송;

if (이메일 발송 성공?) then (아니오)
  :발송 실패 로그 기록;
  :재시도 큐에 추가;
else (예)
  :발송 성공 로그 기록;
endif

:푸시 알림 발송;

if (푸시 발송 성공?) then (아니오)
  :발송 실패 로그 기록;
else (예)
  :발송 성공 로그 기록;
endif

|#LightYellow|알림 조회|
:사용자 알림 목록 요청;

:읽지 않은 알림 개수 계산;

:알림 목록 조회;
note right: 페이지네이션 적용

:200 알림 목록 응답;

|#LightCoral|알림 읽음 처리|
:알림 읽음 처리 요청;

:알림 존재 확인;

if (알림 존재?) then (아니오)
  :404 Not Found 응답;
  stop
endif

:읽음 상태 업데이트;

:읽음 시간 기록;

:200 읽음 처리 완료 응답;

|#LightPink|알림 설정 관리|
:알림 설정 변경 요청;

:설정 데이터 검증;

:사용자 알림 설정 업데이트;

:200 설정 변경 완료 응답;

stop

@enduml
